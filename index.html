<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="WeekTrack" />
  <meta name="theme-color" content="#FAFBFE" />
  <meta name="description" content="每周习惯目标记录追踪" />
  <title>WeekTrack</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>
<div class="bg-glow bg-glow-3"></div>

<div id="app">

  <!-- ── PAGE: HOME ── -->
  <div class="page active" id="page-home">
    <header class="app-header glass-header">
      <div class="header-brand">
        <i class="fa-solid fa-bolt brand-icon"></i>
        <span class="brand-name">WEEKTRACK</span>
      </div>
      <div class="week-pill glass-pill">
        <i class="fa-regular fa-calendar"></i>
        <div class="week-text">
          <span id="week-range">--</span>
          <span id="week-label">第 -- 周</span>
        </div>
      </div>
    </header>
    <main class="cards-container" id="cards-container">
      <!-- 动态渲染 -->
    </main>
  </div>

  <!-- ── PAGE: RECORDS ── -->
  <div class="page" id="page-records">
    <header class="app-header glass-header">
      <div class="header-brand">
        <i class="fa-solid fa-scroll brand-icon"></i>
        <span class="brand-name">WEEK RECORD</span>
      </div>
    </header>

    <!-- 时间维度切换 -->
    <div class="records-time-bar glass-header">
      <button class="time-tab active" data-view="week">本周</button>
      <button class="time-tab" data-view="month">本月</button>
      <button class="time-tab" data-view="all">全部</button>
      <div class="time-nav" id="time-nav">
        <button class="time-nav-btn" id="time-prev"><i class="fa-solid fa-chevron-left"></i></button>
        <span class="time-nav-label" id="time-nav-label"></span>
        <button class="time-nav-btn" id="time-next"><i class="fa-solid fa-chevron-right"></i></button>
      </div>
    </div>

    <!-- 统计摘要 -->
    <div class="records-summary glass-card" id="records-summary"></div>

    <!-- 筛选 Tab -->
    <div class="filter-bar" id="filter-bar"></div>

    <main class="records-container" id="records-list"></main>
  </div>

  <!-- ── PAGE: SETTINGS ── -->
  <div class="page" id="page-settings">
    <header class="app-header glass-header">
      <div class="header-brand">
        <i class="fa-solid fa-sliders brand-icon"></i>
        <span class="brand-name">HABITS</span>
      </div>
    </header>
    <main class="settings-container">
      <div class="settings-section">
        <div class="section-label">我的习惯</div>
        <div id="habits-list"></div>
      </div>
      <button class="btn-add-habit" id="btn-add-habit">
        <i class="fa-solid fa-plus"></i>
        <span>新增习惯</span>
      </button>
    </main>
  </div>

  <!-- ── BOTTOM NAVIGATION ── -->
  <nav class="bottom-nav glass-nav">
    <button class="nav-item active" data-page="home">
      <i class="fa-solid fa-house"></i><span>总览</span>
    </button>
    <button class="nav-item" data-page="records">
      <i class="fa-solid fa-scroll"></i><span>记录</span>
    </button>
    <button class="nav-item" data-page="settings">
      <i class="fa-solid fa-sliders"></i><span>习惯</span>
    </button>
  </nav>

</div>

<!-- OVERLAY -->
<div class="sheet-overlay" id="overlay"></div>

<!-- ====== SHEET: 通用记录 (动态内容) ====== -->
<div class="bottom-sheet glass-sheet" id="sheet-record">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <div class="sheet-title" id="sheet-record-title">
      <i id="sheet-record-icon" class="fa-solid fa-plus"></i>
      <span id="sheet-record-name">记录</span>
    </div>
    <button class="sheet-close" id="close-record"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="sheet-body" id="sheet-record-body">
    <!-- 动态生成 -->
  </div>
</div>

<!-- ====== SHEET: 新增/编辑习惯 ====== -->
<div class="bottom-sheet glass-sheet" id="sheet-habit">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <div class="sheet-title" id="sheet-habit-title">
      <i class="fa-solid fa-sparkles"></i>
      <span>新增习惯</span>
    </div>
    <button class="sheet-close" id="close-habit"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="sheet-body">

    <!-- 习惯类型选择 -->
    <div class="field-group" id="habit-type-group">
      <label class="field-label">习惯类型</label>
      <div class="type-tabs">
        <button class="type-tab selected" data-htype="duration" id="htab-duration">
          <i class="fa-solid fa-clock"></i>时长打卡
        </button>
        <button class="type-tab" data-htype="checkin" id="htab-checkin">
          <i class="fa-solid fa-check-circle"></i>是非打卡
        </button>
      </div>
    </div>

    <!-- 名称 -->
    <div class="field-group">
      <label class="field-label">习惯名称</label>
      <input type="text" id="habit-name" class="field-input" placeholder="例：看书、听播客、早起" maxlength="12" />
    </div>

    <!-- 图标选择 -->
    <div class="field-group">
      <label class="field-label">图标</label>
      <div class="icon-picker" id="icon-picker"></div>
    </div>

    <!-- 颜色选择 -->
    <div class="field-group">
      <label class="field-label">主题色</label>
      <div class="color-picker" id="color-picker"></div>
    </div>

    <!-- 周目标（时长型专用） -->
    <div class="field-group" id="habit-goal-group">
      <label class="field-label">每周目标时长</label>
      <div class="goal-stepper">
        <button class="stepper-btn" id="goal-minus"><i class="fa-solid fa-minus"></i></button>
        <div class="goal-display">
          <span id="goal-hours">3</span>
          <span class="stepper-unit">小时 / 周</span>
        </div>
        <button class="stepper-btn" id="goal-plus"><i class="fa-solid fa-plus"></i></button>
      </div>
    </div>

    <!-- 打卡说明（打卡型专用） -->
    <div class="field-group hidden" id="habit-desc-group">
      <label class="field-label">打卡说明 <span class="field-hint">可选</span></label>
      <input type="text" id="habit-desc" class="field-input" placeholder="例：每天 7 点前起床" />
    </div>

    <button class="btn-save" id="save-habit" style="background: var(--grad-fitness); box-shadow: 0 4px 16px rgba(52,211,153,0.35);">
      <i class="fa-solid fa-check"></i>保存习惯
    </button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- DELETE DIALOG -->
<div class="dialog-overlay" id="dialog-overlay">
  <div class="dialog glass-dialog">
    <div class="dialog-icon"><i class="fa-solid fa-trash-can"></i></div>
    <p class="dialog-title" id="dialog-title">删除这条记录？</p>
    <p class="dialog-desc" id="dialog-desc">此操作不可撤销，进度将同步更新。</p>
    <div class="dialog-actions">
      <button class="dialog-cancel" id="dialog-cancel">取消</button>
      <button class="dialog-confirm" id="dialog-confirm">确认删除</button>
    </div>
  </div>
</div>

<script src="js/app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('./sw.js')
        .then(function(reg) { console.log('SW registered:', reg.scope); })
        .catch(function(err) { console.log('SW failed:', err); });
    });
  }
</script>
</body>
</html>
